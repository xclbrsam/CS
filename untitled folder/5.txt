SET SERVEROUTPUT ON;
SET VERIFY OFF;

-- Create tables
CREATE TABLE CompDep (
    Roll NUMBER(10),
    Name VARCHAR2(20)
);

CREATE TABLE Student (
    Roll NUMBER(10),
    Name VARCHAR2(20)
);

-- Insert data
INSERT INTO Student VALUES (1, 'a');
INSERT INTO Student VALUES (2, 'b');
INSERT INTO Student VALUES (3, 'c');
INSERT INTO Student VALUES (4, 'd');

INSERT INTO CompDep VALUES (2, 'b');
INSERT INTO CompDep VALUES (5, 'e');
INSERT INTO CompDep VALUES (6, 'f');

-- PL/SQL block using parameterized cursor
DECLARE
    CURSOR c_student(p_roll NUMBER) IS
        SELECT roll, name
        FROM student
        WHERE roll = p_roll;

    v_roll NUMBER;
    v_name VARCHAR2(20);
BEGIN
    -- Loop through each student record
    FOR rec IN (SELECT roll, name FROM student) LOOP
        -- Check if this roll number already exists in CompDep
        SELECT COUNT(*) INTO v_roll FROM CompDep WHERE Roll = rec.roll;

        IF v_roll = 0 THEN
            -- If not found, insert the record
            INSERT INTO CompDep VALUES (rec.roll, rec.name);
            DBMS_OUTPUT.PUT_LINE('Inserted Roll: ' || rec.roll || ', Name: ' || rec.name);
        ELSE
            -- If found, skip
            DBMS_OUTPUT.PUT_LINE('Skipped Roll: ' || rec.roll || ' (already exists)');
        END IF;
    END LOOP;

    DBMS_OUTPUT.PUT_LINE('Merge completed successfully!');
END;
/

-- Display final data
SELECT * FROM CompDep;
